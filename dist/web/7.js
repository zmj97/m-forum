(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{122:function(t,e,a){"use strict";var s=a(91);a.n(s).a},123:function(t,e,a){(t.exports=a(7)(!1)).push([t.i,".card-panel[data-v-6b8796af]{margin:1rem}.buttons[data-v-6b8796af]{margin-right:1rem;padding:2px 6px}.bold-font[data-v-6b8796af]{font-weight:700}@media screen and (min-width:800px){.card-panel[data-v-6b8796af]{margin:1rem calc((100vw - 750px)/2)}}",""])},131:function(t,e,a){"use strict";a.r(e);var s={name:"NotificationsPanel",inject:["reload"],data:()=>({tabValue:"apply",applyNotifications:[],resultNotifications:[],replyNotifications:[],newApplyNt:!1,newResultNt:!1,newReplyNt:!1}),computed:{labelApply(){return this.getLabel("小组加入申请",this.newApplyNt)},labelResult(){return this.getLabel("小组申请结果",this.newResultNt)},labelReply(){return this.getLabel("新的回复",this.newReplyNt)}},watch:{tabValue(){!0===this.newResultNt&&"result"===this.tabValue&&this.updateNewNt("newResultNt"),!0===this.newReplyNt&&"reply"===this.tabValue&&this.updateNewNt("newReplyNt")}},methods:{updateNewNt(t){let e={};e[t]=!1,e.username=this.getCurrentUser().username,this.$set(this,t,!1),this.$http.post("/user/update/newNt",e),this.$emit("newNtChange",this.newApplyNt||this.newResultNt||this.newReplyNt)},clearNt(t){let e={};e[t]=[],e.username=this.getCurrentUser().username,this.$http.post("/user/delete/Nt",e).then(t=>{"error"===t.data?this.$Message.error("数据库连接失败!"):(this.$Message.success("清空成功!"),this.reload())}).catch(t=>{console.error(t),this.$Message.error("网络连接错误!")})},getLabel:(t,e)=>a=>a("div",[a("span",t),a("Badge",{props:{dot:e},style:{marginLeft:"10px",marginBottom:"5px"}})]),getNotifications(){this.$http.post("user/find/notifications",{username:this.getCurrentUser().username}).then(t=>{"error"===t.data?this.$Message.error("数据库连接失败!"):(this.applyNotifications=t.data.applyNotifications.reverse(),this.resultNotifications=t.data.resultNotifications.reverse(),this.replyNotifications=t.data.replyNotifications.reverse(),this.newResultNt=t.data.newResultNt,this.newReplyNt=t.data.newReplyNt,t.data.newApplyNt&&this.updateNewNt("newApplyNt"))}).catch(t=>{console.error(t),this.$Message.error("网络连接错误!")})},toPostPanel(t,e){this.$router.push({path:"/home/post",query:{postId:t,replyIndex:e}})},uploadApplyResult(t,e,a){this.$http.post(a,{leader:this.getCurrentUser().username,name:e,username:t}).then(t=>{"error"===t.data?this.$Message.error("数据库连接错误"):this.reload()}).catch(t=>{console.error(t),this.$Message.error("网络连接错误!")})},acceptApply(t,e){this.uploadApplyResult(t,e,"/group/update/accept")},refuseApply(t,e){this.uploadApplyResult(t,e,"/group/update/refuse")}},mounted(){this.getNotifications()}},r=(a(122),a(3)),n=Object(r.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Tabs",{staticStyle:{"background-color":"#eee","overflow-x":"hidden","overflow-y":"auto"},model:{value:t.tabValue,callback:function(e){t.tabValue=e},expression:"tabValue"}},[a("TabPane",{attrs:{label:t.labelApply,name:"apply"}},[0<t.applyNotifications.length?a("div",[a("div",{staticStyle:{"text-align":"center"}},[a("span",{staticStyle:{cursor:"pointer"},on:{click:function(){return t.clearNt("applyNotifications")}}},[a("Icon",{attrs:{type:"ios-trash",size:"24"}}),t._v("清空消息\n        ")],1)]),t._v(" "),t._l(t.applyNotifications,function(e,s){return a("Card",{key:s,staticClass:"card-panel",attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("加入小组申请")]),t._v(" "),a("Button",{staticClass:"buttons",attrs:{slot:"extra",type:"success"},on:{click:function(){return t.acceptApply(e.username,e.groupName)}},slot:"extra"},[t._v("同意")]),t._v(" "),a("Button",{staticClass:"buttons",attrs:{slot:"extra",type:"error"},on:{click:function(){return t.refuseApply(e.username,e.groupName)}},slot:"extra"},[t._v("拒绝")]),t._v(" "),a("p",[t._v("\n          用户\n          "),a("router-link",{attrs:{to:"/home/user/"+e.username}},[t._v("\n            "+t._s(e.username)+"\n          ")]),t._v("\n          申请加入您管理的小组\n          "),a("router-link",{attrs:{to:"/home/group/"+e.groupName}},[t._v("\n            "+t._s(e.groupName)+"\n          ")])],1)],1)})],2):a("p",{staticStyle:{"text-align":"center"}},[t._v("\n      暂无消息\n    ")])]),t._v(" "),a("TabPane",{staticClass:"tab-panel",attrs:{label:t.labelResult,name:"result"}},[0<t.resultNotifications.length?a("div",[a("div",{staticStyle:{"text-align":"center"}},[a("span",{staticStyle:{cursor:"pointer"},on:{click:function(){return t.clearNt("replyNotifications")}}},[a("Icon",{attrs:{type:"ios-trash",size:"24"}}),t._v("清空消息\n        ")],1)]),t._v(" "),t._l(t.resultNotifications,function(e,s){return a("Card",{key:s,staticClass:"card-panel",attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("申请结果")]),t._v(" "),a("p",[t._v("\n          你向\n          "),a("router-link",{attrs:{to:"/home/group/"+e.groupName}},[t._v("\n            "+t._s(e.groupName)+"\n          ")]),t._v("\n          发出的加入申请\n          "),e.result?a("span",{staticStyle:{color:"#19be6b"}},[t._v("已通过")]):a("span",{staticStyle:{color:"#ed4014"}},[t._v("被拒绝")]),t._v("\n          。\n        ")],1)])})],2):a("p",{staticStyle:{"text-align":"center"}},[t._v("\n      暂无消息\n    ")])]),t._v(" "),a("TabPane",{staticClass:"tab-panel",attrs:{label:t.labelReply,name:"reply"}},[0<t.replyNotifications.length?a("div",[a("div",{staticStyle:{"text-align":"center"}},[a("span",{staticStyle:{cursor:"pointer"},on:{click:function(){return t.clearNt("replyNotifications")}}},[a("Icon",{attrs:{type:"ios-trash",size:"24"}}),t._v("清空消息\n        ")],1)]),t._v(" "),t._l(t.replyNotifications,function(e,s){return a("Card",{key:s,staticClass:"card-panel",attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.username)+" 回复了你")]),t._v(" "),a("a",{attrs:{slot:"extra"},on:{click:function(){return t.toPostPanel(e.postId,e.replyIndex)}},slot:"extra"},[t._v("点击查看")]),t._v(" "),a("p",[a("span",{staticClass:"bold-font"},[t._v(t._s(e.username))]),t._v("\n          在帖子\n          "),a("span",{staticClass:"bold-font"},[t._v(t._s(e.title))]),t._v("\n          中回复了你，快去查看吧！ ")])])})],2):a("p",{staticStyle:{"text-align":"center"}},[t._v("\n      暂无消息\n    ")])])],1)},[],!1,null,"6b8796af",null);e.default=n.exports},91:function(t,e,a){var s=a(123);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,a(8).default)("16505b52",s,!0,{})}}]);