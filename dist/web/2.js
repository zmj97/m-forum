(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{106:function(t,e,a){"use strict";var s=a(81);a.n(s).a},107:function(t,e,a){(t.exports=a(6)(!1)).push([t.i,".name[data-v-3d50d2e8]{position:relative;top:4px;margin-left:1rem;font-size:20px}.join-button[data-v-3d50d2e8]{margin-left:1rem;padding:6px 15px 8px;border:1px solid transparent;border-radius:4px;background-color:#19be6b;line-height:1.5;color:#fff;font-weight:400;font-size:12px;outline:0;transition:opacity .2s linear}.join-button[data-v-3d50d2e8]:hover{opacity:.8}.pageSelector[data-v-3d50d2e8]{margin-top:4px;text-align:center}.fade-enter-active[data-v-3d50d2e8],.fade-leave-active[data-v-3d50d2e8]{transition:opacity .5s}.fade-enter[data-v-3d50d2e8],.fade-leave-to[data-v-3d50d2e8]{opacity:0}",""])},128:function(t,e,a){"use strict";a.r(e);var s=a(71),o=a(70),r={name:"GroupPanel",components:{PostModal:s.a,ListItem:o.a},inject:["reload"],data(){return{currentUser:this.$store.state.Users.currentUser.username,name:this.$route.params.name,intro:"",leader:"",users:[],avatar:"",avatars:[],posts:[],postsCount:0,showPost:!1,postPos:0,modalDelete:!1,modalQuit:!1,modalJoin:!1,memberUsername:"",showChangeAvatar:!1,showCropper:!1}},methods:{changeJoinPublic(t){this.$http.post("/group/update/join-public",{name:this.name,joinPublic:t}).then(t=>{"error"===t.data?this.$Message.error("数据库连接失败！"):this.$Message.success("修改成功！")}).catch(t=>{console.error(t),this.$Message.error("网络连接失败！")})},inputImg(t){this.$http.post("/statics/upload-avatar",{name:this.name,_name:this.name+".png",miniurl:t}).then(t=>{this.$http.post("/group/update/avatar",{name:this.name,avatar:t.data}).then(t=>{"success"===t.data?(this.$Message.success("修改成功"),this.$router.push("/home/group/"+this.name),location.reload()):this.$Message.error("修改失败")})})},okJoin(){this.$http.post("/group/create/join",{name:this.name,leader:this.leader,username:this.currentUser}).then(t=>{"success"===t.data?(this.$Message.success("加入成功！"),this.reload()):"applied"===t.data?this.$Message.success("申请成功，请等待组长同意！"):this.$Message.error("数据库连接错误！")}).catch(t=>{console.error(t),this.$Message.error("网络连接错误！")})},isInGroup(){return this.users.includes(this.getCurrentUser().username)},updatePosts(t){this.$http.post("/post/find/limit",{json:{group:this.name},page:t}).then(t=>{this.posts=t.data.data,this.postsCount=t.data.count}).catch(t=>{this.$Message.error("网络连接失败"),console.error(t)})},showPostMethod(t){this.postPos=t,this.showPost=!0},closePost(){this.showPost=!1},okDelete(){this.$http.post("/group/delete",{name:this.name}).then(t=>{"success"===t.data?(this.$Message.success("删除小组成功!"),this.$router.push("/home")):this.$Message.error("删除小组失败!")}).catch(t=>{this.$Message.error("网络连接失败!"),console.error(t)})},okQuit(){this.deleteGroupMembers(this.name,[this.currentUser],()=>{this.$Message.success("退出成功！")})},addMeber(){this.$Modal.confirm({render:t=>t("Input",{props:{value:this.memberUsername,autofocus:!0,placeholder:"请输入要添加成员的用户名"},on:{input:t=>{this.memberUsername=t}}}),onOk:()=>""===this.memberUsername?void alert("请输入用户名！"):this.users.includes(this.memberUsername)?void alert("此用户已在此小组中！"):void this.getUserData(this.memberUsername,()=>{this.$http.post("/group/create/member",{name:this.name,username:this.memberUsername}).then(t=>{"success"===t.data&&(this.$Message.success("添加成功！"),this.reload())})},()=>{this.$Message.error("此用户名不存在！")})})}},mounted(){this.getGroupData(this.name,t=>{t=t[0],this.leader=t.leader,this.intro=t.intro,this.users=t.users,this.avatar=t.avatar,this.getUserData(this.users,t=>{for(let e=0;e<this.users.length;e++)for(let a=0;a<t.length;a++)if(this.users[e]===t[a].username){this.avatars.push(t[a].avatar);break}}),this.isInGroup()&&this.updatePosts(1)})}},i=(a(106),a(3)),n=Object(i.a)(r,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{overflow:"auto"}},[a("Col",{staticStyle:{padding:"1rem"},attrs:{sm:24,md:8}},[a("div",{staticStyle:{"text-align":"center",padding:"1rem 0"}},[a("m-avatar",{attrs:{avatar:t.avatar,size:3}}),t._v(" "),a("span",{staticClass:"name"},[t._v(t._s(t.name))]),t._v(" "),t.currentUser===t.leader?a("div",{staticStyle:{"line-height":"3"}},[a("Poptip",{attrs:{trigger:"hover",placement:"bottom",title:"开放加入",content:"开启后用户可直接加入，关闭时用户需要申请通过组长同意"}},[a("i-switch",{staticStyle:{margin:"0 1rem"},on:{"on-change":t.changeJoinPublic}},[a("Icon",{attrs:{slot:"open",type:"md-checkmark"},slot:"open"}),t._v(" "),a("Icon",{attrs:{slot:"close",type:"md-close"},slot:"close"})],1)],1),t._v(" "),a("Button",{staticStyle:{padding:"1px 3px"},attrs:{type:"error"},on:{click:function(){t.modalDelete=!0}}},[t._v("删除小组")]),t._v(" "),a("Modal",{attrs:{title:"删除小组",zIndex:5e3},on:{"on-ok":t.okDelete},model:{value:t.modalDelete,callback:function(e){t.modalDelete=e},expression:"modalDelete"}},[a("p",[t._v("确定要删除这个小组么？删除后所有小组内的帖子也将被删除！")])]),t._v(" "),a("Button",{staticStyle:{padding:"1px 3px","margin-left":"1rem"},attrs:{type:"info"},on:{click:function(){t.showCropper=!0}}},[t._v("修改头像")]),t._v(" "),a("avatar-cropper",{on:{ok:t.inputImg},model:{value:t.showCropper,callback:function(e){t.showCropper=e},expression:"showCropper"}})],1):t._e(),t._v(" "),t.users.includes(t.currentUser)?t._e():a("button",{staticClass:"join-button",on:{click:function(){t.modalJoin=!0}}},[t._v("加入")]),t._v(" "),a("Modal",{attrs:{title:"加入小组",zIndex:5e3},on:{"on-ok":t.okJoin},model:{value:t.modalJoin,callback:function(e){t.modalJoin=e},expression:"modalJoin"}},[a("p",[t._v("确认要加入这个小组么？")])]),t._v(" "),t.currentUser!==t.leader&&t.users.includes(t.currentUser)?a("Button",{staticStyle:{"margin-left":"1rem"},attrs:{type:"error"},on:{click:function(){t.modalQuit=!0}}},[t._v("退出")]):t._e(),t._v(" "),a("Modal",{attrs:{title:"退出小组",zIndex:5e3},on:{"on-ok":t.okQuit},model:{value:t.modalQuit,callback:function(e){t.modalQuit=e},expression:"modalQuit"}},[a("p",[t._v("确认要退出这个小组么？请谨慎操作！")])]),t._v(" "),a("p",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.intro))])],1),t._v(" "),a("div",{staticStyle:{"margin-top":"2rem"}},[a("p",{staticStyle:{margin:"1rem 0"}},[t._v("组长：")]),t._v(" "),a("Tooltip",{attrs:{content:t.leader}},[a("router-link",{attrs:{to:"/home/user/"+t.leader}},[a("m-avatar",{attrs:{avatar:t.avatars[0],size:1}})],1)],1)],1),t._v(" "),a("div",{staticStyle:{"margin-top":"2rem"}},[a("p",{staticStyle:{margin:"1rem 0"}},[t._v("所有成员：")]),t._v(" "),t._l(t.users,function(e,s){return a("Tooltip",{key:s,staticStyle:{margin:"3px"},attrs:{content:e}},[a("router-link",{attrs:{to:"/home/user/"+e}},[a("m-avatar",{attrs:{avatar:t.avatars[s],size:1}})],1)],1)}),t._v(" "),t.currentUser===t.leader?a("Tooltip",{staticStyle:{margin:"3px"},attrs:{content:"添加成员"}},[a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"md-add",size:"20"},on:{click:t.addMeber}})],1):t._e()],2)]),t._v(" "),a("Col",{attrs:{sm:24,md:{span:8,offset:4}}},[a("Icon",{staticStyle:{margin:"10px"},attrs:{type:"ios-paper",size:"25"}}),t._v("小组内所有帖子\n    "),0<t.posts.length?a("div",[t._l(t.posts,function(e,s){return a("list-item",{key:s,staticClass:"card-margin",attrs:{itemData:e},nativeOn:{click:function(){return t.showPostMethod(s)}}})}),t._v(" "),20<t.postsCount?a("Page",{staticClass:"pageSelector",attrs:{total:t.postsCount,"page-size":20,simple:""},on:{"on-change":t.updatePosts}}):t._e()],2):t._e(),t._v(" "),a("div",{staticStyle:{margin:"5px",padding:"5px"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.isInGroup()&&0==t.posts.length,expression:"isInGroup() && posts.length == 0"}]},[t._v("\n        该小组内还没有发过帖子！\n      ")]),t._v(" "),t.isInGroup()?t._e():a("span",[t._v("\n        无权查看该小组的发帖情况！\n      ")])])],1),t._v(" "),a("transition",{attrs:{name:"fade"}},[a("post-modal",{directives:[{name:"show",rawName:"v-show",value:t.showPost,expression:"showPost"}],attrs:{posts:t.posts,pos:t.postPos},on:{close:t.closePost}})],1)],1)},[],!1,null,"3d50d2e8",null);e.default=n.exports},64:function(t,e,a){var s=a(67);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,a(7).default)("bf8e76ca",s,!0,{})},65:function(t,e,a){var s=a(69);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,a(7).default)("408e0e7a",s,!0,{})},66:function(t,e,a){"use strict";var s=a(64);a.n(s).a},67:function(t,e,a){(t.exports=a(6)(!1)).push([t.i,".item-container[data-v-1cddf317]{position:relative;padding:.9rem .5rem;height:100px;border-bottom:2px solid #ddd;border-left:6px solid transparent;cursor:pointer;transition:background-color .1s linear,color .1s linear}.item-container .left[data-v-1cddf317],.item-container .right[data-v-1cddf317]{position:absolute;top:1rem;bottom:1rem}.item-container .right[data-v-1cddf317]{left:70px;right:1rem}.item-container .item-abstract[data-v-1cddf317],.item-container .item-name[data-v-1cddf317],.item-container .item-title[data-v-1cddf317]{margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.item-container .item-name[data-v-1cddf317]{color:#999}.item-container .item-abstract[data-v-1cddf317]{margin:.4rem 0;font-size:90%}.item-container .group[data-v-1cddf317]{position:absolute;top:-.5rem;right:-.5rem;font-size:90%}.item-container[data-v-1cddf317]:hover{color:#000}.selected[data-v-1cddf317]{background-color:#2b85e4;color:#fff;font-size:105%}.selected .item-name[data-v-1cddf317]{color:#ddd}.selected[data-v-1cddf317]:hover{color:#fff}",""])},68:function(t,e,a){"use strict";var s=a(65);a.n(s).a},69:function(t,e,a){(t.exports=a(6)(!1)).push([t.i,".opacityBackground[data-v-0353f834]{position:fixed;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,.5);z-index:1000}.post[data-v-0353f834]{position:absolute;top:5px;right:5px;bottom:5px;left:5px;border-radius:6px;box-shadow:0 0 1px #fff;background-color:#fff;overflow:auto}.button[data-v-0353f834]{position:relative;font-size:3rem;color:#17233d;opacity:.2;transition:opacity .1s linear;cursor:pointer;z-index:3000}.button[data-v-0353f834]:hover{opacity:.7}.close[data-v-0353f834]{position:fixed;top:2%;right:2%}.left[data-v-0353f834]{left:2%}.left[data-v-0353f834],.right[data-v-0353f834]{display:none;position:fixed;top:50%;margin-top:-1.5rem}.right[data-v-0353f834]{right:2%}@media screen and (min-width:768px){.post[data-v-0353f834]{top:2%;right:8%;bottom:2%;left:8%}}@media screen and (min-width:1200px){.left[data-v-0353f834]{left:4%}.close[data-v-0353f834],.right[data-v-0353f834]{right:4%}}",""])},70:function(t,e,a){"use strict";var s={name:"ListItem",props:{itemData:{require:!0},selected:{default:!1}},data(){return{avatar:null,inGroupPage:-1!==this.$route.matched[1].path.indexOf("group")}},methods:{getAvatar(){this.getUserData(this.itemData.username,t=>{this.avatar=t.avatar})}},mounted(){this.getAvatar()}},o=(a(66),a(3)),r=Object(o.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",{staticClass:"item-container",class:{selected:t.selected}},[a("div",{staticClass:"left"},[a("router-link",{attrs:{to:"/home/user/"+t.itemData.username}},[a("m-avatar",{attrs:{avatar:t.avatar,size:3}})],1)],1),t._v(" "),a("div",{staticClass:"right"},[a("h4",[a("router-link",{staticClass:"item-name",attrs:{to:"/home/user/"+t.itemData.username}},[t._v("\n      "+t._s(t.itemData.username)+"\n      ")])],1),t._v(" "),a("h3",{staticClass:"item-title"},[t._v(t._s(t.itemData.title))]),t._v(" "),a("p",{staticClass:"item-abstract"},[t.itemData.abstract?a("span",[t._v(t._s(t.itemData.abstract))]):a("span",[t._v(t._s(t.itemData.content))])]),t._v(" "),!t.inGroupPage&&t.itemData.group?a("router-link",{attrs:{to:"/home/group/"+t.itemData.group}},[a("Tag",{staticClass:"group",attrs:{color:"success"}},[t._v(t._s(t.itemData.group))])],1):t._e()],1)])},[],!1,null,"1cddf317",null);e.a=r.exports},71:function(t,e,a){"use strict";var s={name:"PostModal",components:{PostPart:a(72).default},props:["posts","pos"],data(){return{posCurrent:this.pos}},watch:{pos(){this.posCurrent=this.pos}},methods:{closeModal(){this.$emit("close")}}},o=(a(68),a(3)),r=Object(o.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"opacityBackground"},[t.posts[t.posCurrent]?a("post-part",{staticClass:"post",attrs:{postData:t.posts[t.posCurrent]}}):t._e(),t._v(" "),a("Icon",{staticClass:"button close",staticStyle:{"-webkit-app-region":"no-drag"},attrs:{type:"md-close-circle"},on:{click:t.closeModal}}),t._v(" "),a("Icon",{directives:[{name:"show",rawName:"v-show",value:0!==t.posCurrent,expression:"posCurrent!==0"}],staticClass:"button left",attrs:{type:"md-arrow-dropleft-circle"},on:{click:function(){t.posCurrent--}}}),t._v(" "),a("Icon",{directives:[{name:"show",rawName:"v-show",value:t.posCurrent!==t.posts.length-1,expression:"posCurrent!==posts.length-1"}],staticClass:"button right",attrs:{type:"md-arrow-dropright-circle"},on:{click:function(){t.posCurrent++}}})],1)},[],!1,null,"0353f834",null);e.a=r.exports},81:function(t,e,a){var s=a(107);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,a(7).default)("6938d95d",s,!0,{})}}]);