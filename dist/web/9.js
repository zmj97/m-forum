(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{118:function(t,e,a){"use strict";var i=a(89);a.n(i).a},119:function(t,e,a){(t.exports=a(7)(!1)).push([t.i,".hint-center[data-v-1ab6c4ad]{position:relative;top:50%;line-height:40px;text-align:center;transform:translateY(-50%)}.wiki-container[data-v-1ab6c4ad]{margin:30px 16px;overflow:auto}#versions[data-v-1ab6c4ad]{width:100%;margin-bottom:30px;padding:0 10px;border:1px solid #ccc;background-color:#eee}#versions li[data-v-1ab6c4ad]{border-top:1px solid #ccc;padding:10px 0;line-height:1.5}.bold120pc[data-v-1ab6c4ad]{font-size:120%;font-weight:700;line-height:2;cursor:pointer;transition:color .2s linear}.bold120pc[data-v-1ab6c4ad]:hover{color:#2d8cf0}.page-info[data-v-1ab6c4ad]{padding:10px 0;border-bottom:1px solid #ccc}.page-info .versions-hint[data-v-1ab6c4ad]{cursor:pointer;transition:color .2s}.page-info .versions-hint[data-v-1ab6c4ad]:hover{color:#2d8cf0}.page-info .delete-page[data-v-1ab6c4ad]{color:#ed4014}.page-info .change-authority[data-v-1ab6c4ad]{color:#f90}.page-info .new-page[data-v-1ab6c4ad]{color:#19be6b}.page-info .change-authority[data-v-1ab6c4ad],.page-info .delete-page[data-v-1ab6c4ad],.page-info .new-page[data-v-1ab6c4ad]{transition:opacity .2s}.page-info .change-authority[data-v-1ab6c4ad]:hover,.page-info .delete-page[data-v-1ab6c4ad]:hover,.page-info .new-page[data-v-1ab6c4ad]:hover{opacity:.8}#content[data-v-1ab6c4ad]{padding:24px 0}.nav[data-v-1ab6c4ad]{padding:0 10px;border:1px solid #ccc;background-color:#eee;line-height:3}#titles[data-v-1ab6c4ad]{list-style:none;border-top:1px solid #ccc}@media screen and (min-width:768px){#page[data-v-1ab6c4ad]{float:left;width:100%;padding-right:300px}.nav[data-v-1ab6c4ad]{display:inline-block;float:left;width:230px;margin-left:-255px;margin-top:50px}}.fade-enter-active[data-v-1ab6c4ad],.fade-leave-active[data-v-1ab6c4ad]{transition:opacity .2s}.fade-enter[data-v-1ab6c4ad],.fade-leave-to[data-v-1ab6c4ad]{opacity:0}@media screen and (min-width:1100px){.wiki-container[data-v-1ab6c4ad]{width:1000px;margin-left:calc((100vw - 1000px) / 2)}}",""])},135:function(t,e,a){"use strict";a.r(e);var i=a(13),s={name:"WikiPanel",inject:["reload"],data:()=>({page:null,titles:[],showAllVersions:!1,showModifyGroups:!1,groups:[],joinedGroups:[],modalDelete:!1,modalUpdateGroups:!1}),methods:{inGroups(t){return!(0!==t.length)||this.joinedGroups.some(function(e){return t.some(function(t){return t===e})})},getTitles(){this.$http.post("/wiki/find/titles").then(t=>{t.data.forEach(t=>{this.inGroups(t.groups)&&this.titles.push(t)});let e=this.$route.query.title;if(e){if(this.titles.some(t=>t.title===e))return void this.getPage(e);this.$Message.error("无权查看！")}0<this.titles.length&&this.getPage(this.titles[0].title)}).catch(t=>{this.$Message.error("网络连接失败"),console.error(t)})},getPage(t){this.$http.post("/wiki/find/page",{title:t}).then(t=>{this.page=t.data,this.page.allVersions.reverse(),this.groups=this.page.groups}).catch(t=>{this.$Message.error("网络连接失败"),console.error(t)})},okDelete(){this.$http.post("/wiki/delete",{_id:this.page._id}).then(t=>{"success"===t.data?(this.$Message.success("删除成功"),this.reload()):this.$Message.error("删除失败")})},toEditPage(){this.$router.push({path:"/home/new-wiki",query:{title:this.page.title,content:this.page.lastestVersion.content}})},okUpdateGroups(){this.$http.post("/wiki/update/groups",{title:this.page.title,groups:this.groups}).then(t=>{"success"===t.data?(this.$Message.success("删除成功"),this.reload()):this.$Message.error("删除失败")})},cancelUpdateGroups(){this.showModifyGroups=!1,this.groups=this.page.groups},clickOldVersion(t){this.page.lastestVersion=t,window.location.hash="#title"}},computed:{convertedContent(){if(!this.page||!this.page.lastestVersion.content)return"";let t=i.mavonEditor.getMarkdownIt().render(this.page.lastestVersion.content),e=t.indexOf("<img src=");for(;-1!==e;)e=(t=t.slice(0,e+5)+'style="display: block;max-width: 100%;" '+t.slice(e+5)).indexOf("<img src=");return t}},filters:{timeFilter(t){var e=new Date(t),a=new Date;return e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getYear()===a.getYear()?"今天"+e.toLocaleString().split(" ")[1]:e.getDate()+1===a.getDate()&&e.getMonth()===a.getMonth()&&e.getYear()===a.getYear()?"昨天"+e.toLocaleString().split(" ")[1]:e.toLocaleString()}},mounted(){this.getJoinedGroupsNames(this.getCurrentUser().username,this.joinedGroups),setTimeout(()=>{this.getTitles()},10)}},o=(a(118),a(3)),n=Object(o.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{overflow:"auto"}},[0===t.titles.length?a("div",{staticClass:"hint-center"},[a("h3",[t._v("快来添加第一个wiki page吧!")]),t._v(" "),a("router-link",{attrs:{to:"/home/new-wiki"}},[a("Button",{attrs:{type:"success"}},[t._v("\n        新建一个page\n      ")])],1)],1):t._e(),t._v(" "),t.page?a("div",{staticClass:"wiki-container"},[a("div",{attrs:{id:"page"}},[a("transition",{attrs:{name:"fade"}},[t.showAllVersions?a("section",{attrs:{id:"versions"}},[a("h3",{staticClass:"bold120pc",on:{click:function(){t.showAllVersions=!1}}},[t._v("Revisions(点击关闭)")]),t._v(" "),t._l(t.page.allVersions,function(e,i){return a("ul",{key:i},[a("li",[a("p",{staticClass:"bold120pc",on:{click:function(){return t.clickOldVersion(e)}}},[t._v(t._s(e.editMessage))]),t._v(" "),a("div",[a("span",{staticClass:"bold120pc"},[a("router-link",{attrs:{to:"/home/user/"+e.username}},[t._v("\n                    "+t._s(e.username)+"\n                  ")])],1),t._v("\n                修改于\n                "+t._s(t._f("timeFilter")(e.time))+"\n              ")])])])})],2):t._e()]),t._v(" "),a("h1",{attrs:{id:"title"}},[t._v(t._s(t.page.title)+" ")]),t._v(" "),a("div",{staticClass:"page-info"},[a("router-link",{attrs:{to:"/home/user/"+t.page.lastestVersion.username}},[t._v("\n          "+t._s(t.page.lastestVersion.username)+"\n        ")]),t._v("\n        修改于\n        "+t._s(t._f("timeFilter")(t.page.lastestVersion.time))+" ·\n        "),a("span",{staticClass:"versions-hint",on:{click:function(){t.showAllVersions=!t.showAllVersions}}},[t._v(t._s(t.page.allVersions.length)+" 个版本")]),t._v(" "),a("div",[a("a",{on:{click:t.toEditPage}},[t._v("[编辑]")]),t._v("\n           · "),a("a",{staticClass:"delete-page",on:{click:function(){t.modalDelete=!0}}},[t._v("[删除]")]),t._v("\n           · "),a("a",{staticClass:"change-authority",on:{click:function(){t.showModifyGroups=!t.showModifyGroups}}},[t._v("[修改权限]")]),t._v("\n           · "),a("router-link",{staticClass:"new-page",attrs:{to:"/home/new-wiki"}},[t._v("[新建]")])],1),t._v(" "),a("Modal",{attrs:{title:"删除page",zIndex:5e3},on:{"on-ok":t.okDelete},model:{value:t.modalDelete,callback:function(e){t.modalDelete=e},expression:"modalDelete"}},[a("p",[t._v("确定要删除这个page么？")])]),t._v(" "),a("transition",{attrs:{name:"fade"}},[t.showModifyGroups?a("section",{staticStyle:{padding:"15px 0"}},[a("p",[t._v("不设定小组时，所有人均可浏览与编辑")]),t._v(" "),a("Select",{staticStyle:{width:"auto"},attrs:{multiple:"",clearable:"",placeholder:"修改要限定的小组(多选)","not-found-text":"还没有小组"},model:{value:t.groups,callback:function(e){t.groups=e},expression:"groups"}},t._l(t.joinedGroups,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v("\n                "+t._s(e)+"\n              ")])}),1),t._v(" "),a("Button",{attrs:{type:"success"},on:{click:function(){t.modalUpdateGroups=!0}}},[t._v("确认")]),t._v(" "),a("Button",{attrs:{type:"info"},on:{click:t.cancelUpdateGroups}},[t._v("取消")]),t._v(" "),a("Modal",{attrs:{title:"修改小组权限",zIndex:5e3},on:{"on-ok":t.okUpdateGroups},model:{value:t.modalUpdateGroups,callback:function(e){t.modalUpdateGroups=e},expression:"modalUpdateGroups"}},[a("p",[t._v("确定要修改这个page的小组权限么？")])])],1):t._e()])],1),t._v(" "),a("article",{staticClass:"content-list",attrs:{id:"content"},domProps:{innerHTML:t._s(t.convertedContent)}})],1),t._v(" "),a("nav",{staticClass:"nav"},[a("h3",[t._v("Pages · "+t._s(t.titles.length))]),t._v(" "),t._l(t.titles,function(e){return a("ul",{key:e.title,attrs:{id:"titles"}},[a("li",[a("a",{on:{click:function(){return t.getPage(e.title)}}},[t._v(t._s(e.title))])])])})],2)]):t._e()])},[],!1,null,"1ab6c4ad",null);e.default=n.exports},89:function(t,e,a){var i=a(119);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(8).default)("56c87d93",i,!0,{})}}]);