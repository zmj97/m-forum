(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{104:function(t,e,s){"use strict";s.r(e);var i={name:"NewPage",data(){return{allGroups:[],modalSave:!1,wikiData:{title:"",lastestVersion:{username:this.$store.state.Users.currentUser.username,time:null,content:"",editMessage:""},allVersions:[],groups:[]},isEdit:!!this.$route.query.title,imgFiles:{}}},methods:{$imgAdd(t,e){this.imgFiles[t]=e},$imgDel(t){delete this.imgFiles[t]},async okSave(){return""===this.wikiData.title.replace(/\s+/g,"")?void this.$Message.error("标题内容不能为空!"):""===this.wikiData.lastestVersion.content.replace(/\s+/g,"")?void this.$Message.error("内容不能为空!"):""===this.wikiData.lastestVersion.editMessage.replace(/\s+/g,"")?void this.$Message.error("编辑信息内容不能为空!"):(this.wikiData.lastestVersion.time=new Date,{}!==this.imgFiles&&await this.$http.post("/statics/upload",this.imgFiles).then(t=>{t.data.forEach(t=>{this.$refs.md.$img2Url(t[0],t[1])})}),this.isEdit?void this.$http.post("/wiki/update/edit",{title:this.wikiData.title,lastestVersion:this.wikiData.lastestVersion}).then(t=>{"success"===t.data?(this.$Message.success("编辑成功!"),this.$router.push("/home/wiki")):this.$Message.error("数据库连接失败，请重试！")}).catch(t=>{this.$Message.error("网络连接失败!"),console.error(t)}):(this.wikiData.allVersions.push(this.wikiData.lastestVersion),void this.$http.post("/wiki/create/new",this.wikiData).then(t=>{"repeat"===t.data?this.$Message.error("标题已存在！"):"success"===t.data?(this.$Message.success("发布成功"),this.$router.push("/home/wiki")):this.$Message.error("数据库连接失败，请重试！")}).catch(t=>{this.$Message.error("网络连接失败!"),console.error(t)})))}},mounted(){this.isEdit?(this.wikiData.title=this.$route.query.title,this.wikiData.lastestVersion.content=this.$route.query.content):this.getJoinedGroupsNames(this.getCurrentUser().username,this.allGroups)}},a=(s(87),s(1)),o=Object(a.a)(i,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{overflow:"auto"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.wikiData.title,expression:"wikiData.title"}],attrs:{id:"title",type:"text",name:"title",placeholder:"标题，最多输入30个字符",maxlength:30},domProps:{value:t.wikiData.title},on:{input:function(e){e.target.composing||t.$set(t.wikiData,"title",e.target.value)}}}),t._v(" "),t.isEdit?t._e():s("section",[s("h3",{staticClass:"hint"},[t._v("限定小组(仅限定小组的成员可浏览与编辑)")]),t._v(" "),s("Select",{staticClass:"set-groups",staticStyle:{width:"auto","z-index":"499"},attrs:{multiple:"",clearable:"",placeholder:"可选择要限定的小组(多选)","not-found-text":"还没有小组"},model:{value:t.wikiData.groups,callback:function(e){t.$set(t.wikiData,"groups",e)},expression:"wikiData.groups"}},t._l(t.allGroups,function(e){return s("Option",{key:e,attrs:{value:e}},[t._v("\n        "+t._s(e)+"\n      ")])}),1)],1),t._v(" "),s("h3",{staticClass:"hint"},[t._v("编辑内容")]),t._v(" "),s("mathjax-toolbar",{attrs:{contentId:"editor"}}),t._v(" "),s("mavon-editor",{ref:"md",attrs:{id:"editor",ishljs:!0,scrollStyle:!0,autofocus:!1},on:{imgAdd:t.$imgAdd,imgDel:t.$imgDel},model:{value:t.wikiData.lastestVersion.content,callback:function(e){t.$set(t.wikiData.lastestVersion,"content",e)},expression:"wikiData.lastestVersion.content"}}),t._v(" "),s("h3",{staticClass:"hint"},[t._v("编辑信息")]),t._v(" "),s("Input",{attrs:{id:"editMessage",size:"large",placeholder:"最多输入100个字符",clearable:"",maxlength:100},model:{value:t.wikiData.lastestVersion.editMessage,callback:function(e){t.$set(t.wikiData.lastestVersion,"editMessage",e)},expression:"wikiData.lastestVersion.editMessage"}}),t._v(" "),s("Button",{staticClass:"save",attrs:{type:"success"},on:{click:function(){t.modalSave=!0}}},[t._v("保存")]),t._v(" "),s("Modal",{attrs:{title:"保存",zIndex:5e3},on:{"on-ok":t.okSave},model:{value:t.modalSave,callback:function(e){t.modalSave=e},expression:"modalSave"}},[s("p",[t._v("确定要保存么？")])])],1)},[],!1,null,"00dd794e",null);e.default=o.exports},57:function(t,e,s){var i=s(88);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,s(5).default)("6428422f",i,!0,{})},87:function(t,e,s){"use strict";var i=s(57);s.n(i).a},88:function(t,e,s){(t.exports=s(4)(!1)).push([t.i,"#title[data-v-00dd794e]{width:100%;border:0;padding-left:5px;margin:10px 0;font-size:40px;outline:none}#editor[data-v-00dd794e]{z-index:1000}.set-groups[data-v-00dd794e]{position:relative;z-index:5000;margin:10px 0}.hint[data-v-00dd794e]{margin:40px 0 10px 5px}.save[data-v-00dd794e]{margin:20px 0 10px 5px}",""])}}]);