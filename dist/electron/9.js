(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{103:function(e,t,a){"use strict";a.r(t);var i=a(9),s={name:"WikiPanel",inject:["reload"],data:()=>({page:null,titles:[],showAllVersions:!1,showModifyGroups:!1,groups:[],joinedGroups:[],modalDelete:!1,modalUpdateGroups:!1}),methods:{inGroups(e){return!(0!==e.length)||this.joinedGroups.some(function(t){return e.some(function(e){return e===t})})},getTitles(){this.$http.post("/wiki/find/titles").then(e=>{e.data.forEach(e=>{this.inGroups(e.groups)&&this.titles.push(e)});let t=this.$route.query.title;if(t){if(this.titles.some(e=>e.title===t))return void this.getPage(t);this.$Message.error("无权查看！")}0<this.titles.length&&this.getPage(this.titles[0].title)}).catch(e=>{this.$Message.error("网络连接失败"),console.error(e)})},getPage(e){this.$http.post("/wiki/find/page",{title:e}).then(e=>{this.page=e.data,this.page.allVersions.reverse(),this.groups=this.page.groups}).catch(e=>{this.$Message.error("网络连接失败"),console.error(e)})},okDelete(){this.$http.post("/wiki/delete",{_id:this.page._id}).then(e=>{"success"===e.data?(this.$Message.success("删除成功"),this.reload()):this.$Message.error("删除失败")})},toEditPage(){this.$router.push({path:"/home/new-wiki",query:{title:this.page.title,content:this.page.lastestVersion.content}})},okUpdateGroups(){this.$http.post("/wiki/update/groups",{title:this.page.title,groups:this.groups}).then(e=>{"success"===e.data?(this.$Message.success("删除成功"),this.reload()):this.$Message.error("删除失败")})},cancelUpdateGroups(){this.showModifyGroups=!1,this.groups=this.page.groups},clickOldVersion(e){this.page.lastestVersion=e,window.location.hash="#title"}},computed:{convertedContent(){if(!this.page||!this.page.lastestVersion.content)return"";let e=i.mavonEditor.getMarkdownIt().render(this.page.lastestVersion.content),t=e.indexOf("<img src=");for(;-1!==t;)t=(e=e.slice(0,t+5)+'style="display: block;max-width: 100%;" '+e.slice(t+5)).indexOf("<img src=");return e}},filters:{timeFilter(e){var t=new Date(e),a=new Date;return t.getDate()===a.getDate()&&t.getMonth()===a.getMonth()&&t.getYear()===a.getYear()?"今天"+t.toLocaleString().split(" ")[1]:t.getDate()+1===a.getDate()&&t.getMonth()===a.getMonth()&&t.getYear()===a.getYear()?"昨天"+t.toLocaleString().split(" ")[1]:t.toLocaleString()}},mounted(){this.getJoinedGroupsNames(this.getCurrentUser().username,this.joinedGroups),setTimeout(()=>{this.getTitles()},10)}},o=(a(85),a(1)),n=Object(o.a)(s,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{overflow:"auto"}},[0===e.titles.length?a("div",{staticClass:"hint-center"},[a("h3",[e._v("快来添加第一个wiki page吧!")]),e._v(" "),a("router-link",{attrs:{to:"/home/new-wiki"}},[a("Button",{attrs:{type:"success"}},[e._v("\n        新建一个page\n      ")])],1)],1):e._e(),e._v(" "),e.page?a("div",{staticClass:"wiki-container"},[a("div",{attrs:{id:"page"}},[a("transition",{attrs:{name:"fade"}},[e.showAllVersions?a("section",{attrs:{id:"versions"}},[a("h3",{staticClass:"bold120pc",on:{click:function(){e.showAllVersions=!1}}},[e._v("Revisions(点击关闭)")]),e._v(" "),e._l(e.page.allVersions,function(t,i){return a("ul",{key:i},[a("li",[a("p",{staticClass:"bold120pc",on:{click:function(){return e.clickOldVersion(t)}}},[e._v(e._s(t.editMessage))]),e._v(" "),a("div",[a("span",{staticClass:"bold120pc"},[a("router-link",{attrs:{to:"/home/user/"+t.username}},[e._v("\n                    "+e._s(t.username)+"\n                  ")])],1),e._v("\n                修改于\n                "+e._s(e._f("timeFilter")(t.time))+"\n              ")])])])})],2):e._e()]),e._v(" "),a("h1",{attrs:{id:"title"}},[e._v(e._s(e.page.title)+" ")]),e._v(" "),a("div",{staticClass:"page-info"},[a("router-link",{attrs:{to:"/home/user/"+e.page.lastestVersion.username}},[e._v("\n          "+e._s(e.page.lastestVersion.username)+"\n        ")]),e._v("\n        修改于\n        "+e._s(e._f("timeFilter")(e.page.lastestVersion.time))+" ·\n        "),a("span",{staticClass:"versions-hint",on:{click:function(){e.showAllVersions=!e.showAllVersions}}},[e._v(e._s(e.page.allVersions.length)+" 个版本")]),e._v(" "),a("div",[a("a",{on:{click:e.toEditPage}},[e._v("[编辑]")]),e._v("\n           · "),a("a",{staticClass:"delete-page",on:{click:function(){e.modalDelete=!0}}},[e._v("[删除]")]),e._v("\n           · "),a("a",{staticClass:"change-authority",on:{click:function(){e.showModifyGroups=!e.showModifyGroups}}},[e._v("[修改权限]")]),e._v("\n           · "),a("router-link",{staticClass:"new-page",attrs:{to:"/home/new-wiki"}},[e._v("[新建]")])],1),e._v(" "),a("Modal",{attrs:{title:"删除page",zIndex:5e3},on:{"on-ok":e.okDelete},model:{value:e.modalDelete,callback:function(t){e.modalDelete=t},expression:"modalDelete"}},[a("p",[e._v("确定要删除这个page么？")])]),e._v(" "),a("transition",{attrs:{name:"fade"}},[e.showModifyGroups?a("section",{staticStyle:{padding:"15px 0"}},[a("p",[e._v("不设定小组时，所有人均可浏览与编辑")]),e._v(" "),a("Select",{staticStyle:{width:"auto"},attrs:{multiple:"",clearable:"",placeholder:"修改要限定的小组(多选)","not-found-text":"还没有小组"},model:{value:e.groups,callback:function(t){e.groups=t},expression:"groups"}},e._l(e.joinedGroups,function(t){return a("Option",{key:t,attrs:{value:t}},[e._v("\n                "+e._s(t)+"\n              ")])}),1),e._v(" "),a("Button",{attrs:{type:"success"},on:{click:function(){e.modalUpdateGroups=!0}}},[e._v("确认")]),e._v(" "),a("Button",{attrs:{type:"info"},on:{click:e.cancelUpdateGroups}},[e._v("取消")]),e._v(" "),a("Modal",{attrs:{title:"修改小组权限",zIndex:5e3},on:{"on-ok":e.okUpdateGroups},model:{value:e.modalUpdateGroups,callback:function(t){e.modalUpdateGroups=t},expression:"modalUpdateGroups"}},[a("p",[e._v("确定要修改这个page的小组权限么？")])])],1):e._e()])],1),e._v(" "),a("article",{staticClass:"content-list",attrs:{id:"content"},domProps:{innerHTML:e._s(e.convertedContent)}})],1),e._v(" "),a("nav",{staticClass:"nav"},[a("h3",[e._v("Pages · "+e._s(e.titles.length))]),e._v(" "),e._l(e.titles,function(t){return a("ul",{key:t.title,attrs:{id:"titles"}},[a("li",[a("a",{on:{click:function(){return e.getPage(t.title)}}},[e._v(e._s(t.title))])])])})],2)]):e._e()])},[],!1,null,"2ae2cdaf",null);t.default=n.exports},56:function(e,t,a){var i=a(86);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(5).default)("75b844f4",i,!0,{})},85:function(e,t,a){"use strict";var i=a(56);a.n(i).a},86:function(e,t,a){(e.exports=a(4)(!1)).push([e.i,".hint-center[data-v-2ae2cdaf]{position:relative;top:50%;line-height:40px;text-align:center;transform:translateY(-50%)}.wiki-container[data-v-2ae2cdaf]{margin:30px 16px;overflow:auto}#versions[data-v-2ae2cdaf]{width:100%;margin-bottom:30px;padding:0 10px;border:1px solid #ccc;background-color:#eee}#versions li[data-v-2ae2cdaf]{border-top:1px solid #ccc;padding:10px 0;line-height:1.5}.bold120pc[data-v-2ae2cdaf]{font-size:120%;font-weight:700;line-height:2;cursor:pointer;transition:color .2s linear}.bold120pc[data-v-2ae2cdaf]:hover{color:#2d8cf0}.page-info[data-v-2ae2cdaf]{padding:10px 0;border-bottom:1px solid #ccc}.page-info .versions-hint[data-v-2ae2cdaf]{cursor:pointer;transition:color .2s}.page-info .versions-hint[data-v-2ae2cdaf]:hover{color:#2d8cf0}.page-info .delete-page[data-v-2ae2cdaf]{color:#ed4014}.page-info .change-authority[data-v-2ae2cdaf]{color:#f90}.page-info .new-page[data-v-2ae2cdaf]{color:#19be6b}.page-info .change-authority[data-v-2ae2cdaf],.page-info .delete-page[data-v-2ae2cdaf],.page-info .new-page[data-v-2ae2cdaf]{transition:opacity .2s}.page-info .change-authority[data-v-2ae2cdaf]:hover,.page-info .delete-page[data-v-2ae2cdaf]:hover,.page-info .new-page[data-v-2ae2cdaf]:hover{opacity:.8}#content[data-v-2ae2cdaf]{padding:24px 0}.nav[data-v-2ae2cdaf]{padding:0 10px;border:1px solid #ccc;background-color:#eee;line-height:3}#titles[data-v-2ae2cdaf]{list-style:none;border-top:1px solid #ccc}@media screen and (min-width:768px){#page[data-v-2ae2cdaf]{float:left;width:100%;padding-right:300px}.nav[data-v-2ae2cdaf]{display:inline-block;float:left;width:230px;margin-left:-255px;margin-top:50px}}.fade-enter-active[data-v-2ae2cdaf],.fade-leave-active[data-v-2ae2cdaf]{transition:opacity .2s}.fade-enter[data-v-2ae2cdaf],.fade-leave-to[data-v-2ae2cdaf]{opacity:0}@media screen and (min-width:1100px){.wiki-container[data-v-2ae2cdaf]{width:1000px;margin-left:calc((100vw - 1000px) / 2)}}",""])}}]);